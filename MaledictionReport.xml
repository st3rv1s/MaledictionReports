<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- MuClient version 5.07-pre -->
<!-- Plugin "MaledictionAnnounce" generated by Plugin Wizard -->

<muclient>
  <plugin
   name="MaledictionReport"
   author="Kanaye"
   id="2558d613691a941bb5f1398b"
   language="Lua"
   purpose="A plugin to help you notify others of landed maledictions"
   date_written="2024-7-24 17:59:57"
   requires="5.07"
   version="1.1"
  >
  
<description trim="y">
<![CDATA[

+-------------------------[Malediction Report!]-------------------------+
|                                                                       |
|          Type 'malrep' to toggle between ON and OFF state.            |
|                                                                       |
+-----------------------------------------------------------------------+

]]>
</description> 
  
  </plugin>
  
<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Aliases  -->
  <aliases>
  
    <alias
    match="^malrep$"
    enabled="y"
    regexp="y"
    send_to="12"
    sequence="100"
    script="debuff_toggle"
    >
    </alias>
  
  </aliases>
  
  <!--  Script -->
  <script>
   <![CDATA[

require "gmcphelper"

function OnHelp ()
  world.Note (world.GetPluginInfo (world.GetPluginID (), 3))
end

local debuff_master = "ON"

function debuff_toggle()
 	if debuff_master == "ON"
 		then
 			debuff_master = "OFF"
 			EnableGroup("debuffs", false)
			ColourNote ("darkred", "dimgrey", "Malediction reports are DISABLED!")
	elseif debuff_master == "OFF"
		then
			debuff_master = "ON"
			EnableGroup("debuffs", true)
			ColourNote ("limegreen", "dimgrey", "Malediction reports are ENABLED!")
	end
end

function OnPluginInstall()
	OnHelp()
end

   ]]>
  </script>

<!-- Include standard constants -->
<include name="constants.lua"/>

   <!-- Triggers -->
  <triggers>
  
    <!-- Trigger for FLIES -->
    <trigger
      name="Flies"
      match="^You unleash a swarm of flies upon (.+?)!$"
      enabled="y"
	  group="debuffs"
      regexp="y"
      send_to="12"
      ignore_case="y"
      sequence="100" 
    >
      <send>
	  -- Broadcast the malediction
      SendNoEcho("gt @WFLIED! @C(@D%1@C)@Y")
      </send>
    </trigger>
	
    <!-- Trigger for SANCTUARY -->
    <trigger
      name="Sanc"
      match="^The white aura around (.+)\'s body vanishes\.$"
      enabled="y"
	  group="debuffs"
      regexp="y"
      send_to="12"
      ignore_case="y"
      sequence="100" 
    >
      <send>
	  -- Broadcast the malediction
      SendNoEcho("say @WSANC OFF! @C(@D%1@C)@Y")
      </send>
    </trigger>
	
    <!-- Trigger for REVERSE ALIGN (EVIL) -->
    <trigger
      name="RevEvil"
      match="^You banish (.+?) to the forces of shadow\.$"
      enabled="y"
	  group="debuffs"
      regexp="y"
      send_to="12"
      ignore_case="y"
      sequence="100" 
    >
      <send>
	  -- Broadcast the malediction
      SendNoEcho("gt @WREV'D! @C(@D%1@C)@Y")
      </send>
    </trigger>
	
    <!-- Trigger for REVERSE ALIGN (GOOD) -->
    <trigger
      name="RevGood"
      match="^You banish (.+?) to the forces of light\.$"
      enabled="y"
	  group="debuffs"
      regexp="y"
      send_to="12"
      ignore_case="y"
      sequence="100" 
    >
      <send>
	  -- Broadcast the malediction
      SendNoEcho("gt @WREV'D! @C(@D%1@C)@Y")
      </send>
    </trigger>
	
    <!-- Trigger for WEAKEN -->
    <trigger
      name="Weaken"
      match="^(.*?) looks tired and weak\.$"
      enabled="y"
	  group="debuffs"
      regexp="y"
      send_to="12"
      ignore_case="y"
      sequence="100" 
    >
      <send>
	  -- Broadcast the malediction
      SendNoEcho("say @WWEAKEN'D! @C(@D%1@C)@Y")
      </send>
    </trigger>
	
	<!-- Trigger for SOFTEN -->
    <trigger
      name="Soften"
      match="^(.*?)\'s armor softens\.$"
      enabled="y"
	  group="debuffs"
      regexp="y"
      send_to="12"
      ignore_case="y"
      sequence="100" 
    >
      <send>
	  -- Broadcast the malediction
      SendNoEcho("say @WSOFTEN'D! @C(@D%1@C)@Y")
      </send>
    </trigger>
	
	<!-- Trigger for RUNE of IX -->
    <trigger
      name="Rune"
      match="^You mark (.+) with a Rune of IX!"
      enabled="y"
	  group="debuffs"
      regexp="y"
      send_to="12"
      ignore_case="y"
      sequence="100" 
    >
      <send>
	  -- Broadcast the malediction
      SendNoEcho("say @WRUNE'D! @C(@D%1@C)@Y")
      </send>
    </trigger>
	
	<!-- Trigger for RAVEN SPRAY -->
    <trigger
      name="Raven"
      match="^Your acidic venom burns away (.+)\'s armor\.$"
      enabled="y"
	  group="debuffs"
      regexp="y"
      send_to="12"
      ignore_case="y"
      sequence="100" 
    >
      <send>
	  -- Broadcast the malediction
      SendNoEcho("say @WRAVEN'D! @C(@D%1@C)@Y")
      </send>
    </trigger>
	
	<!-- Trigger for MARBU -->
    <trigger
      name="Marbu"
      match="^(.+) falls to (.*?) knees blinded."
      enabled="y"
	  group="debuffs"
      regexp="y"
      send_to="12"
      ignore_case="y"
      sequence="100" 
    >
      <send>
	  -- Broadcast the malediction
      SendNoEcho("say @WMARBU'D! @C(@D%1@C)@Y")
      </send>
    </trigger>
	
  <!-- Trigger for the first line of Kspray -->
  <trigger
    name="KsprayFirstLine"
    match="^You spray (.+) with a huge rotting Kobold gland\.$"
    enabled="y"
	group="debuffs"
    regexp="y"
    send_to="12"
    ignore_case="y"
    sequence="100"
    >
    <send>
      -- Store the matched part and set the context for Kspray
      world.SetVariable("KsprayTarget", "%1")
      world.SetVariable("CurrentAction", "Kspray")
    </send>
    </trigger>
    
    <!-- Trigger for the first line of Kobold -->
    <trigger
      name="KoboldFirstLine"
      match="^You spray (.+) with a rotting kobold gland\.$"
      enabled="y"
	  group="debuffs"
      regexp="y"
      send_to="12"
      ignore_case="y"
      sequence="110"
      >
      <send>
        -- Store the matched part and set the context for Kobold
        world.SetVariable("KoboldTarget", "%1")
        world.SetVariable("CurrentAction", "Kobold")
      </send>
    </trigger>
    
    <!-- Combined trigger for the second line -->
    <trigger
      name="SecondLineCombined"
      match="^(.+) turns pale and appears weakened\.$"
      enabled="y"
	  group="debuffs"
      regexp="y"
      send_to="12"
      ignore_case="y"
      sequence="120"
      >
      <send>
        -- Check the current action context and act accordingly
        local action = world.GetVariable("CurrentAction")
        local target = nil
        
        if action == "Kspray" then
          target = world.GetVariable("KsprayTarget")
          if target then
            SendNoEcho(string.format("say @WKSPRAY'D! @C(@D%s@C)@Y", target))
            -- Clear the variable after use
            world.SetVariable("KsprayTarget", "")
          end
        elseif action == "Kobold" then
          target = world.GetVariable("KoboldTarget")
          if target then
            SendNoEcho(string.format("say @WKOBOL'D! @C(@D%s@C)@Y", target))
            -- Clear the variable after use
            world.SetVariable("KoboldTarget", "")
          end
        end
        
        -- Clear the action context after processing
        world.SetVariable("CurrentAction", "")
      </send>
    </trigger>
	
	<!-- Trigger for HYDRA -->
    <trigger
      name="Hydra"
      match="^(.+) appears to falter. Your victim is in serious trouble\!$"
      enabled="y"
	  group="debuffs"
      regexp="y"
      send_to="12"
      ignore_case="y"
      sequence="100" 
    >
      <send>
	  -- Broadcast the malediction
      SendNoEcho("say @WHYDRA'D! @C(@D%1@C)@Y")
      </send>
    </trigger>
	
	<!-- Trigger for GREEN DEATH -->
    <trigger
      name="GreenDeath"
      match="^(.+) appears much weaker and extremely vulnerable."
      enabled="y"
	  group="debuffs"
      regexp="y"
      send_to="12"
      ignore_case="y"
      sequence="100" 
    >
      <send>
	  -- Broadcast the malediction
      SendNoEcho("say @WGREEN DEATH'D! @C(@D%1@C)@Y")
      </send>
    </trigger>
	
	<!-- Trigger for GREEN DEATH -->
    <trigger
      name="Ego"
      match="^You ridicule (.*?) about (.*?) childhood\.$"
      enabled="y"
	  group="debuffs"
      regexp="y"
      send_to="12"
      ignore_case="y"
      sequence="100" 
    >
      <send>
	  -- Broadcast the malediction
      SendNoEcho("say @WEGO'D! @C(@D%1@C)@Y")
      </send>
    </trigger>
	
	<!-- Trigger for DISEASE -->
    <trigger
      name="Disease"
      match="^(.+) looks unwell."
      enabled="y"
	  group="debuffs"
      regexp="y"
      send_to="12"
      ignore_case="y"
      sequence="100" 
    >
      <send>
	  -- Broadcast the malediction
      SendNoEcho("say @WDISEASE'D! @C(@D%1@C)@Y")
      </send>
    </trigger>
	
	<!-- Trigger for CURSE -->
    <trigger
      name="Curse"
      match="^(.*?) looks (.*?) uncomfortable\.$"
      enabled="y"
	  group="debuffs"
      regexp="y"
      send_to="12"
      ignore_case="y"
      sequence="100" 
    >
      <send>
	  -- Broadcast the malediction
      SendNoEcho("say @WCURSE'D! @C(@D%1@C)@Y")
      </send>
    </trigger>

   <!-- Trigger for THIEF -->
	
	<!-- Trigger for NECRO -->
    <trigger
      name="Necro"
      match="^You reach out and touch (.+), injecting (.+) with deadly necrotic poison\.$"
      enabled="y"
	  group="debuffs"
      regexp="y"
      send_to="12"
      ignore_case="y"
      sequence="100" 
    >
      <send>
	  -- Broadcast the malediction
      SendNoEcho("say @WNECRO'D! @C(@D%1@C)@Y")
      </send>
    </trigger>
	
    <trigger
      name="Balor"
      match="^.*You sense that your poison has greatly reduced (.*?)'s health\.$|^You sense that your poison has greatly reduced (.*?) health\.$"
      enabled="y"
	  group="debuffs"
      regexp="y"
      send_to="12"
      ignore_case="y"
      sequence="100"
    >
      <send>
      -- Broadcast the malediction
      SendNoEcho("say @WBALOR'D! @C(@D%1@C)@Y")
      </send>
    </trigger>
	
	<trigger
      name="Assassinate"
      match="^You assassinate (/+?) with cold efficiency\.$"
      enabled="y"
	  group="debuffs"
      regexp="y"
      send_to="12"
      ignore_case="y"
      sequence="100"
    >
      <send>
      -- Broadcast the malediction
      SendNoEcho("gt @WASS'D @C(@D%1@C)@Y")
      </send>
    </trigger>
	
  </triggers>

</muclient>